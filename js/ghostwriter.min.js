$(document).ready(function(){var p={degrees:["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"]};p.findChromaticScale=function(v){var t=new Array();for(var u=0;u<this.degrees.length;u++){if(v==this.degrees[u]){var s=u}}for(var u=s;u<this.degrees.length;u++){t.push(this.degrees[u])}for(var u=0;u<s;u++){t.push(this.degrees[u])}return t};p.findMajorScale=function(x){var t=this.findChromaticScale(x);var s=new Array();for(var w=0;w<t.length;w++){if(s.length==0){var u=t[w].slice(1);if(u=="#"){var z=t[w+1]+"b";t[w]=z}}else{var v=s[s.length-1].slice(0,1);var y=t[w].slice(0,1);if(v==y){var z=t[w+1]+"b";t[w]=z}}s.push(t[w]);if(w!==4){w++}}return s};p.findMinorScale=function(u){var w=p.findRelativeMajor(u);var s=p.findMajorScale(w);var v=new Array();for(var t=5;t<s.length;t++){v.push(s[t])}for(var t=0;t<5;t++){v.push(s[t])}return v};p.findRelativeMajor=function(t){var s=this.findChromaticScale(t);var u=s[3];return u};p.findFlatSeven=function(w){var t=p.findChromaticScale(w);var s=t[11];var u=s.slice(1);if(u=="#"){var v=w+"b"}else{var v=s}return v};var c=[{name:"default",nextProbability:[{name:"1",tonality:"major",probability:0.19},{name:"2",tonality:"major",probability:0.007},{name:"2",tonality:"minor",probability:0.05},{name:"3",tonality:"major",probability:0.01},{name:"3",tonality:"minor",probability:0.03},{name:"4",tonality:"major",probability:0.18},{name:"5",tonality:"major",probability:0.16},{name:"6",tonality:"minor",probability:0.14},{name:"7",tonality:"major",probability:0.01},{name:"7",tonality:"dim",probability:0.002}]},{name:"1",tonality:"major",nextProbability:[{name:"1",tonality:"major",probability:0},{name:"2",tonality:"major",probability:0.01},{name:"2",tonality:"minor",probability:0.04},{name:"3",tonality:"major",probability:0.008},{name:"3",tonality:"minor",probability:0.05},{name:"4",tonality:"major",probability:0.21},{name:"5",tonality:"major",probability:0.31},{name:"6",tonality:"minor",probability:0.09},{name:"7",tonality:"major",probability:0.02},{name:"7",tonality:"dim",probability:0}]},{name:"2",tonality:"major",nextProbability:[{name:"1",tonality:"major",probability:0.03},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0},{name:"3",tonality:"major",probability:0.06},{name:"3",tonality:"minor",probability:0},{name:"4",tonality:"major",probability:0.28},{name:"5",tonality:"major",probability:0.18},{name:"6",tonality:"minor",probability:0.13},{name:"7",tonality:"major",probability:0},{name:"7",tonality:"dim",probability:0}]},{name:"2",tonality:"minor",nextProbability:[{name:"1",tonality:"major",probability:0.14},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0},{name:"3",tonality:"major",probability:0.02},{name:"3",tonality:"minor",probability:0.08},{name:"4",tonality:"major",probability:0.17},{name:"5",tonality:"major",probability:0.25},{name:"6",tonality:"minor",probability:0.1},{name:"7",tonality:"major",probability:0},{name:"7",tonality:"dim",probability:0}]},{name:"3",tonality:"major",nextProbability:[{name:"1",tonality:"major",probability:0.01},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0.03},{name:"3",tonality:"major",probability:0},{name:"3",tonality:"minor",probability:0},{name:"4",tonality:"major",probability:0.37},{name:"5",tonality:"major",probability:0.01},{name:"6",tonality:"minor",probability:0.41},{name:"7",tonality:"major",probability:0},{name:"7",tonality:"dim",probability:0}]},{name:"3",tonality:"minor",nextProbability:[{name:"1",tonality:"major",probability:0.03},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0.1},{name:"3",tonality:"major",probability:0},{name:"3",tonality:"minor",probability:0},{name:"4",tonality:"major",probability:0.33},{name:"5",tonality:"major",probability:0.04},{name:"6",tonality:"minor",probability:0.41},{name:"7",tonality:"major",probability:0},{name:"7",tonality:"dim",probability:0}]},{name:"4",tonality:"major",nextProbability:[{name:"1",tonality:"major",probability:0.34},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0.04},{name:"3",tonality:"major",probability:0.01},{name:"3",tonality:"minor",probability:0.03},{name:"4",tonality:"major",probability:0},{name:"5",tonality:"major",probability:0.27},{name:"6",tonality:"minor",probability:0.09},{name:"7",tonality:"major",probability:0.01},{name:"7",tonality:"dim",probability:0}]},{name:"5",tonality:"major",nextProbability:[{name:"1",tonality:"major",probability:0.27},{name:"2",tonality:"major",probability:0.006},{name:"2",tonality:"minor",probability:0.05},{name:"3",tonality:"major",probability:0.008},{name:"3",tonality:"minor",probability:0.04},{name:"4",tonality:"major",probability:0.22},{name:"5",tonality:"major",probability:0},{name:"6",tonality:"minor",probability:0.26},{name:"7",tonality:"major",probability:0.01},{name:"7",tonality:"dim",probability:0}]},{name:"6",tonality:"minor",nextProbability:[{name:"1",tonality:"major",probability:0.11},{name:"2",tonality:"major",probability:0.01},{name:"2",tonality:"minor",probability:0.06},{name:"3",tonality:"major",probability:0.01},{name:"3",tonality:"minor",probability:0.04},{name:"4",tonality:"major",probability:0.32},{name:"5",tonality:"major",probability:0.25},{name:"6",tonality:"minor",probability:0},{name:"7",tonality:"major",probability:0.02},{name:"7",tonality:"dim",probability:0}]},{name:"7",tonality:"major",nextProbability:[{name:"1",tonality:"major",probability:0.15},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0.01},{name:"3",tonality:"major",probability:0.01},{name:"3",tonality:"minor",probability:0},{name:"4",tonality:"major",probability:0.25},{name:"5",tonality:"major",probability:0.04},{name:"6",tonality:"minor",probability:0.18},{name:"7",tonality:"major",probability:0},{name:"7",tonality:"dim",probability:0}]},{name:"7",tonality:"dim",nextProbability:[{name:"1",tonality:"major",probability:0.2},{name:"2",tonality:"major",probability:0},{name:"2",tonality:"minor",probability:0},{name:"3",tonality:"major",probability:0.07},{name:"3",tonality:"minor",probability:0},{name:"4",tonality:"major",probability:0},{name:"5",tonality:"major",probability:0},{name:"6",tonality:"minor",probability:0.73},{name:"7",tonality:"major",probability:0},{name:"7",tonality:"dim",probability:0}]}];j();f();b();$(".scaleOption").change(function(){j();f();b()});function j(){$(".degreeBox").each(function(){var t=$(this).attr("id").slice(6);var s=$("#tonalitySelect").val();$(this).removeClass("major minor flat dim");if(s=="major"){if(t==1||t==4||t==5){$(this).addClass("major")}else{if(t==2||t==3||t==6){$(this).addClass("minor")}else{$(this).addClass("dim")}}}else{if(s=="minor"){if(t==3||t==6||t==7){$(this).addClass("major")}else{if(t==1||t==4||t==5){$(this).addClass("minor")}else{$(this).addClass("dim")}}}}})}function f(){var t=e();for(var u=0;u<t.length;u++){if($("#degree"+(u+1)).hasClass("major")){var s="Major"}else{if($("#degree"+(u+1)).hasClass("minor")){var s="Minor"}else{if($("#degree"+(u+1)).hasClass("flat")){t[u]=p.findFlatSeven(t[u]);var s="Major"}else{if($("#degree"+(u+1)).hasClass("dim")){var s="Dim"}}}}$("#degree"+(u+1)).text(t[u]+" "+s)}}function e(){var u=$("#keySelect").val();var t=$("#tonalitySelect").val();if(t=="major"){var s=p.findMajorScale(u)}else{if(t=="minor"){var s=p.findMinorScale(u)}}return s}function b(s){$(".tonalityToggle").hide();var s=$("#tonalitySelect").val();if(s=="major"){$(".majorToggle").show()}else{if(s=="minor"){$(".minorToggle").show()}}}$(".tonalityToggle").click(function(){if($(this).siblings().hasClass("major")){$(this).siblings().removeClass("major").addClass("minor")}else{if($(this).siblings().hasClass("minor")){$(this).siblings().removeClass("minor").addClass("major")}else{if($(this).siblings().hasClass("dim")){$(this).siblings().removeClass("dim").addClass("flat")}else{if($(this).siblings().hasClass("flat")){$(this).siblings().removeClass("flat").addClass("dim")}}}}f()});var a=new Array();var h=4;$("#scaleDisplay").on("click",".degreeBox",function(){if(a.length==h){return}var s=$(this).text();a.push(s);o()});$(".chordBox").hover(function(){if($(this).text()!==""){$(this).css("cursor","pointer").addClass("delete")}},function(){$(this).css("cursor","default").removeClass("delete")});$("#progressionDisplay").on("click",".chordBox",function(){var s=$(this).attr("id").slice(5)-1;a.splice(s,1);o();if($(this).text()==""){$(this).css("cursor","default").removeClass("delete")}});function o(){$(".chordBox").text("");for(var s=0;s<a.length;s++){$("#chord"+(s+1)).text(a[s])}}$("#randomButton").click(function(){var s=m();r(s)});function m(){if(a.length==0){var w="default"}else{var u=a[a.length-1];var w=u.slice(0,2).replace(/\s/g,"");var t=u.slice(2).replace(/\s/g,"").toLowerCase()}var s=q(w);for(var v=0;v<c.length;v++){if(s==c[v].name&&t==c[v].tonality){var x=c[v].nextProbability}}return x}function r(B){var s=0;for(var x=0;x<B.length;x++){s+=B[x].probability}var A=Math.random()*s;for(var x=0;x<B.length;x++){var C=0;var u=0;for(var v=0;v<(x+1);v++){C=u;u+=B[v].probability}if(A>C&&A<u){var t=B[x].name;var z=i(t);var y=B[x].tonality;if(t==7&&y=="major"){z=p.findFlatSeven(z)}var w=z+" "+y;a.push(w);o()}}}function q(v){if(v=="default"){var t="default"}else{var s=n();for(var u=0;u<s.length;u++){if(v==s[u]){var t=u+1}}if(!t){var t=7}}return t}function i(t){var s=n();var u=s[t-1];return u}function n(){var u=$("#keySelect").val();var t=$("#tonalitySelect").val();if(t=="major"){var s=p.findMajorScale(u)}else{if(t=="minor"){var v=p.findRelativeMajor(u);var s=p.findMajorScale(v)}}return s}$("#playButton").hover(function(){$(this).attr("src","img/inverted_play.png")},function(){$(this).attr("src","img/play.png")});var l=new Array();$("#playButton").click(function(){d();g()});$("#audioClip").on("ended",function(){if(l.length!==0){g()}});function d(){$(".chordBox").each(function(){var s=$(this).text();var t=k(s);if(t.length!==0){l.push(t)}})}function k(u){var w=u.slice(0,2).replace(/\s/g,"");var s=u.slice(2).replace(/\s/g,"");var t=p.findChromaticScale(w);var v=w.slice(1);if(v=="#"){w=t[1]+"b"}var x=w+s;return x}function g(){var t=l.shift();$("#audioClip").attr("src","audio/"+t+".mp3");var s=document.getElementById("audioClip");s.play()}$("label").popover({html:true,placement:"bottom",trigger:"hover"});$("#infoModal").modal({backdrop:false,show:false});$("#infoIcon").click(function(){$("#infoModal").modal("show")});$("#skinSelector button").click(function(){$(".skinElement").removeClass("blueSkin greenSkin orangeSkin");var s=$(this).attr("data-skin");$(".skinElement").addClass(s)});$("#chordChartModal").modal({backdrop:false,show:false});$(".chordChartIcon").click(function(){var s=$(this).siblings(".degreeBox").text();$("#chordChartTitle").text(s);var t=k(s);$("#chordChartImage").attr("src","img/charts/"+t+".png");$("#chordChartModal").modal("show")})});