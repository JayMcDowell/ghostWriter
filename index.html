<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta name="description" content="A tool for songwriters." />
  <meta http-equiv="author" content="Jack Whitis" />
  <title>Ghost Writer</title>

  <!-- csss files -->
  <link href="css/bootstrap.min.css" type="text/css" rel="stylessheet" />
  <link href="css/bootstrap-responsive.min.css" type="text/css" rel="stylessheet" />
  <link href="css/styles.css" type="text/css" rel="stylesheet" />

  <!-- js files -->
  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <script type="text/javascript">
  $(document).ready(function() {

// **************** scale object ***************

    var scale = {
      degrees: ["c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b"]
    };

    scale.findChromaticScale = function(key) {

      // create empty scale array
      var chromaticScale = new Array();

      // fill variable with index position of key
      for (var i = 0; i < this.degrees.length; i++) {
        if (key == this.degrees[i]) {
          var rootIndex = i;
        };
      };

      // add succeeding degrees to chromatic scale array
      for (var i = rootIndex; i < this.degrees.length; i++) {
        chromaticScale.push(this.degrees[i]);
      };

      // add preceeding degrees to chromatic scale array
      for (var i = 0; i < rootIndex; i++) {
        chromaticScale.push(this.degrees[i]);
      };

      return chromaticScale;

    }; // end findChromaticScale method

    scale.findMajorScale = function(key) {

      // fill variable with chromatic scale array
      var chromaticScale = this.findChromaticScale(key);

      // create empty scale array
      var majorScale = new Array();

      // loop through degrees in chromatic scale array
      for (var i = 0; i < chromaticScale.length; i++) {

        // determine if major scale array is empty
        if (majorScale.length == 0) {

          // fill variable with accidental of tonic
          var accidental = chromaticScale[i].slice(1);

          // determine if tonic is sharp
          if (accidental == "#") {

            // fill variable with equivalent flat scale degree
            var flat = chromaticScale[i + 1] + "b";

            // make current scale degree flat
            chromaticScale[i] = flat;

          }; // end if statement

        } else {

          // fill variable with previous scale degree minus accidentals
          var previousDegree = majorScale[majorScale.length - 1].slice(0, 1);

          // fill variable with current scale degree minus accidentals
          var currentDegree = chromaticScale[i].slice(0, 1);

          // determine if previous degree and current degree are equal
          if (previousDegree == currentDegree) {

            // fill variable with equivalent flat scale degree
            var flat = chromaticScale[i + 1] + "b";

            // make current scale degree flat
            chromaticScale[i] = flat;

          }; // end if statement

        }; // end if statement

        // add scale degree to major scale array
        majorScale.push(chromaticScale[i]);

        // increment counter again if current degree is not 4th degree in chromatic scale
        // (This is what sets the scale intervals that define a major scale.)
        if (i !== 4) {
          i++;
        };

      }; // end for loop

      return majorScale;

    }; // end findMajorScale method

    scale.findMinorScale = function(key) {

      // fill variable with relative major key
      var relativeMajor = scale.findRelativeMajor(key);

      // fill variable with relative major scale array
      var majorScale = scale.findMajorScale(relativeMajor);

      // create empty scale array
      var minorScale = new Array();

      // add succeeding degrees to minor scale array
      for (var i = 5; i < majorScale.length; i++) {
        minorScale.push(majorScale[i]);
      };

      // add preceeding degrees to minor scale array
      for (var i = 0; i < 5; i++) {
        minorScale.push(majorScale[i]);
      };

      return minorScale;

    }; // end findMinorScale method

    scale.findRelativeMajor = function(key) {

      // fill variable with chromatic scale array
      var chromaticScale = this.findChromaticScale(key);

      // fill variable with relative major using fixed interval
      var relativeMajor = chromaticScale[3];

      return relativeMajor;

    }; // end findRelativeMajor method

// **************** chord positions array ***************

    var chordPositions = [
      {
        name: "default",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "1",
        tonality: "major",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "2",
        tonality: "major",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "2",
        tonality: "minor",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "3",
        tonality: "major",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "3",
        tonality: "minor",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "4",
        tonality: "major",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "5",
        tonality: "major",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "6",
        tonality: "minor",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "7",
        tonality: "flat",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      },
      {
        name: "7",
        tonality: "diminished",
        nextProbability: [
          {name: "1", tonality: "major", probability: .100},
          {name: "2", tonality: "major", probability: .100},
          {name: "2", tonality: "minor", probability: .100},
          {name: "3", tonality: "major", probability: .100},
          {name: "3", tonality: "minor", probability: .100},
          {name: "4", tonality: "major", probability: .100},
          {name: "5", tonality: "major", probability: .100},
          {name: "6", tonality: "minor", probability: .100},
          {name: "7", tonality: "flat", probability: .100},
          {name: "7", tonality: "diminished", probability: .100}
        ]
      }
    ]; // end chordPositions array

// **************** write scale on page load ***************

    // assign tonality to scale degrees
    assignTonality();

    // write scale to page
    writeScale();

// **************** update scale on select box change ***************

    // change event on key select box
    $(".scaleOptions").change(function() {

      // assign tonality to scale degrees
      assignTonality();

      // write scale to page
      writeScale();

    }); // end change event

// **************** assign tonality to scale degrees ***************

    function assignTonality() {

      // loop through boxes in scale display
      $(".degreeBox").each(function() {

        // fill variable with position of scale degree
        var scaleDegree = $(this).attr("id").slice(6);

        // fill variable with value of tonality select box
        var tonality = $("#tonalitySelect").val();

        // clear existing tonality classes
        $(this).removeClass("major minor flat diminished");

        // fill variable with correct scale array
        if (tonality == "major") {
          if (scaleDegree == 1 || scaleDegree == 4 || scaleDegree == 5 ) {
            $(this).addClass("major");
          } else if (scaleDegree == 2 || scaleDegree == 3 || scaleDegree == 6 ) {
            $(this).addClass("minor");
          } else {
            $(this).addClass("diminished");
          };
        } else if (tonality == "minor") {
          if (scaleDegree == 3 || scaleDegree == 6 || scaleDegree == 7 ) {
            $(this).addClass("major");
          } else if (scaleDegree == 1 || scaleDegree == 4 || scaleDegree == 5 ) {
            $(this).addClass("minor");
          } else {
            $(this).addClass("diminished");
          };
        };

      }); // end each event

    }; // end assignTonality function

// **************** write scale to page ***************

    function writeScale() {

      // fill variables with value of scale options
      var userScale = findScaleFromSelection();

      // clear contents of scale display
      $(".degreeBox").text("");

      // loop through degrees of user scale
      for (var i = 0; i < userScale.length; i++) {

        // fill variable with existing tonality class
        if ($("#degree" + (i + 1)).hasClass("major")) {
          var tonality = "Major";
        } else if ($("#degree" + (i + 1)).hasClass("minor")) {
          var tonality = "Minor";
        } else if ($("#degree" + (i + 1)).hasClass("diminished")) {
          var tonality = "Diminished";
        } else {
          var tonality = "Flat Major";
        };

        // write chord names to scale display
        $("#degree" + (i + 1)).text(userScale[i] + " " + tonality);

      }; // end for loop

    }; // end writeScale function

// **************** find scale from selection ***************

    function findScaleFromSelection() {

      // fill variables with value of scale options
      var key = $("#keySelect").val();
      var tonality = $("#tonalitySelect").val();

      // fill variable with correct scale array
      if (tonality == "major") {
        var userScale = scale.findMajorScale(key);
      } else if (tonality == "minor") {
        var userScale = scale.findMinorScale(key);
      };

      return userScale;

    }; // end findScaleFromSelection function

// **************** toggle tonality of scale degrees ***************

    $(".tonalityToggle").click(function() {

      // replace existing tonality class with alternative tonality class
      if ($(this).prev().hasClass("major")) {
        $(this).prev().removeClass("major").addClass("minor");
      } else if ($(this).prev().hasClass("minor")) {
        $(this).prev().removeClass("minor").addClass("major");
      } else if ($(this).prev().hasClass("diminished")) {
        $(this).prev().removeClass("diminished").addClass("flat");
      } else {
        $(this).prev().removeClass("flat").addClass("diminished");
      };

      // update scale on page
      writeScale();

    }); // end click event

// **************** add chord to progression array ***************

    // create empty array
    var progression = new Array();

    // define maximum number of chords in progression
    var chordMax = 4;

    // click event on scale display boxes
    $("#scaleDisplay").on("click", ".degreeBox", function() {

      // exit function if progression contains maximum number of chords
      if (progression.length == chordMax) {
        return;
      };

      // fill variable with contents of box
      var chord = $(this).text();

      // push chord name into progression array
      progression.push(chord);

      // write progression to page
      writeProgression();

    }); // end click event

// **************** remove chord from progression array ***************

    // click event on progression display boxes
    $("#progressionDisplay").on("click", ".chordBox", function() {

      // fill variable with index of chord in progression array
      var chordIndex = $(this).attr("id").slice(5) - 1;

      // remove chord name from progression array
      progression.splice(chordIndex, 1);

      // write progression to page
      writeProgression();

    }); // end click event

// **************** activate random chord button ***************

    $("#randomButton").click(function() {

      // find next chord probability
      var nextProbability = findNextProbability();

      // generate random chord
      findRandomChord(nextProbability);

    }); // end click event

// **************** find next chord probability ***************

    function findNextProbability() {

      // determine if there are chords in progression array
      if (progression.length == 0) { // if array is empty

        // fill variable with "default" value
        var previousDegree = "default";

      } else { // if array contains chords

        // fill variable with name of last chord in array
        var previousChord = progression[progression.length - 1];

        // fill variable with scale degree by removing tonality designation
        var previousDegree = previousChord.slice(0, 2).replace(/\s/g, "");

        // fill variable with tonality designation by removing scale degree
        var previousTonality = previousChord.slice(2).replace(/s\s/g, "").toLowerCase();

      }; // end if statement

      // fill variable with position of previous degree
      var previousPosition = findPositionFromDegree(previousDegree);

      // loop through chord positions array
      for (var i = 0; i < chordPositions.length; i++) {

        // fill variable with next chord probability array
        if (previousPosition == chordPositions[i].name && previousTonality == chordPositions[i].tonality) {
          var nextProbability = chordPositions[i].nextProbability;
        };

      }; // end for loop

      return nextProbability;

    }; // end findNextProbability function

// **************** generate random chord ***************

    function findRandomChord(nextProbability) {

      // fill variable with random number
      var randomNumber = Math.random();

      console.log(randomNumber);

      // loop through objects in next chord probability array
      for (var i = 0; i < nextProbability.length; i++) {

        // initialize probability counters at 0
        var lowerLimit = 0;
        var upperLimit = 0;

        // loop through objects with index less than "i"
        for (var j = 0; j < (i + 1); j++) {

          // assign lower probability limit
          lowerLimit = upperLimit;

          // increment upper probability limit
          upperLimit += nextProbability[j].probability;

        };

        // determine if random number falls within probability range
        if (randomNumber > lowerLimit && randomNumber < upperLimit) {

          // fill variable with position of random chord
          var randomPosition = nextProbability[i].name;

          // fill variable with scale degree of random chord
          var randomDegree = findDegreeFromPosition(randomPosition);

          // fill variable with tonality of random chord
          var randomTonality = nextProbability[i].tonality;

          // fill variable with chord name by combining scale degree and tonality
          var randomChord = randomDegree + " " + randomTonality;

          // add random chord to progression array
          progression.push(randomChord);

          // write progression to page
          writeProgression();

        }; // end if statement

      }; // end for loop

    }; // end findRandomChord function

// **************** find position from degree ***************

    function findPositionFromDegree(degree) {

      // determine if previous degree has been selected
      if (degree == "default") {

        // fill variable with "default"
        var position = "default";

      } else {

        // fill variable with correct scale array
        var userScale = findScaleFromSelection();

        // fill variable with chord position
        for (var i = 0; i < userScale.length; i++) {
          if (degree == userScale[i]) {
            var position = i + 1;
          };
        };

      }; // end if statement

      return position;

    }; // end findPositionFromDegree function

// **************** find degree from position ***************

    function findDegreeFromPosition(position) {

      // fill variable with correct scale array
      var userScale = findScaleFromSelection();

      // fill variable with scale degree
      var degree = userScale[position - 1];

      return degree;

    }; // end findDegreeFromPosition function

// **************** write progression to page ***************

    function writeProgression() {

      // clear contents of progression display
      $(".chordBox").text("");

      // write chord name to progression display
      for (var i = 0; i < progression.length; i++) {
        $("#chord" + (i + 1)).text(progression[i]);
      };

    }; // end writeProgression function

// **************** activate play audio button ***************

    // create empty array
    var playlist = new Array();

    // click event on play audio button
    $("#playButton").click(function() {

      // update playlist array
      updatePlaylist();

      // play audio clips
      playAudio();

    }); // end click event

// **************** loop play audio function ***************

    $("#audioClip").on("ended", function() {
      if (playlist.length !== 0) {
        playAudio();
      };
    }); // end ended event

// **************** update playlist ***************

    function updatePlaylist() {

      // loop through boxes in progression display
      $(".chordBox").each(function() {

        // fill variable with contents of chord box
        var chordName = $(this).text().replace(/\s/g, "");

        // add chord name to playlist array
        if (chordName.length !== 0) {
          playlist.push(chordName);
        };

      }); // end each method

    }; // end updatePlaylist function

// **************** play audio clip ***************

    function playAudio() {

      // confirm contents of playlist array
      console.log("Playlist: " + playlist);

      // fill variable with first chord in playlist
      var nowPlaying = playlist.shift();

      // replace source attribute of audio element
      $("#audioClip").attr("src", "audio/" + nowPlaying + ".wav");

      // fill variable with audio element
      var audioClip = document.getElementById("audioClip");

      // play audio clip
      audioClip.play();

    }; // end playAudio function

// **************** end script ***************

  }); // end ready
  </script>
</head>
<body>

  <form>
    <label for="keySelect">
      Choose a key:
    </label>
    <select id="keySelect" class="scaleOptions" name="key">
      <option value="c" selected>C</option>
      <option value="c#">C#/Db</option>
      <option value="d">D</option>
      <option value="d#">D#/Eb</option>
      <option value="e">E</option>
      <option value="f">F</option>
      <option value="f#">F#/Gb</option>
      <option value="g">G</option>
      <option value="g#">G#/Ab</option>
      <option value="a">A</option>
      <option value="a#">A#/Bb</option>
      <option value="b">B</option>
    </select>
    <br />
    <label for="tonalitySelect">
      Choose a tonality:
    </label>
    <select id="tonalitySelect" class="scaleOptions" name="tonality">
      <option value="major" selected>Major</option>
      <option value="minor">Minor</option>
    </select>
    <br />
  </form>
  <div>
    <button id="randomButton">Random</button>
  </div>

  <br />

  <div id="scaleDisplay">
    <div id="degree1" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
    <div id="degree2" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
    <div id="degree3" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
    <div id="degree4" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
    <div id="degree5" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
    <div id="degree6" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
    <div id="degree7" class="degreeBox"></div>
    <button class="tonalityToggle">Tonality</button>
  </div><!-- end #scaleDisplay -->

  <br />

  <div id="progressionDisplay">
    <div id="chord1" class="chordBox"></div>
    <div id="chord2" class="chordBox"></div>
    <div id="chord3" class="chordBox"></div>
    <div id="chord4" class="chordBox"></div>
  </div>

  <button id="playButton">Play</button>
  <audio id="audioClip" src=""></audio>

</body>
</html>